{% extends "base.html" %}
{% block content %}
<h1>Available Products</h1>
<a href="{{ url_for('products.add_product') }}">Add New Product</a>

<!-- Product container -->
<div id="product-list"></div>

<script>
  // Fetch products from Flask backend
  function loadProducts() {
    fetch("/products/all")
      .then(response => response.json())
      .then(data => {
        const list = document.getElementById("product-list");
        list.innerHTML = ""; // Clear before adding
        data.forEach(product => {
          const card = document.createElement("div");
          card.className = "product-card";

          // Product info
          let html = `
            <h3>${product.name}</h3>
            <p><strong>Price:</strong> $${product.price}</p>
          `;

          if (product.description) {
            html += `<p>${product.description}</p>`;
          }

          if (product.image_url) {
            html += `<img src="${product.image_url}" alt="${product.name}" class="product-image">`;
          } else {
            console.log("Imagem recebida:", product.image_url);
            html += `<img src="https://via.placeholder.com/150" alt="placeholder" class="product-image">`;
          }

          // Delete button
          html += `<button onclick="deleteProduct(${product.id})">Delete</button>`;

          card.innerHTML = html;
          list.appendChild(card);
        });
      });
  }

  // Delete a product by ID
  function deleteProduct(productId) {
    fetch(`/products/delete/${productId}`, { method: "POST" })
      .then(response => response.json())
      .then(data => {
        alert(data.message);
        loadProducts(); // refresh
      });
  }

  // Load products on page load
  loadProducts();
</script>
{% endblock %}



