{% extends "base.html" %}
{% block content %}
<h1>Dashboard</h1>
<div id="dashboard-content"></div>

<script>
fetch("/dashboard/data")
  .then(r => r.json())
  .then(data => {
    const container = document.getElementById("dashboard-content");

    if (data.error === "not_logged_in") {
      container.textContent = "To access dashboard login first";
      return;
    }

    if (data.subscriptions && data.subscriptions.length === 0) {
      container.textContent = "No subscriptions yet";
      return;
    }

    if (data.subscriptions) {
      const list = document.createElement("ul");
      data.subscriptions.forEach(sub => {
        const li = document.createElement("li");
        li.textContent = `${sub.product} | Status: ${sub.status} | Started: ${sub.start_date}`;

        if (sub.status === "active") {
          const btn = document.createElement("button");
          btn.textContent = "Cancel";
          btn.onclick = () => {
            fetch(`/subscriptions/${sub.id}/cancel`, { method: "POST" })
              .then(() => location.reload());
          };
          li.appendChild(btn);
        }

        list.appendChild(li);
      });
      container.appendChild(list);
    }
  })
  .catch(() => {
    document.getElementById("dashboard-content").textContent = "Error loading dashboard.";
  });
</script>
{% endblock %}
